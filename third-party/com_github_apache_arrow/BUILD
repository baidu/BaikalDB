licenses(["notice"])

genrule(
    name = "build_version",
    outs = [
        "cpp/src/arrow/util/config.h",
    ],
    cmd = "echo '#define ARROW_VERSION_MAJOR 0' >> $(@) && echo '#define ARROW_VERSION_MINOR 17' >> $(@) && echo '#define ARROW_VERSION_PATCH 1' >> $(@) && echo '#define ARROW_VERSION ((ARROW_VERSION_MAJOR * 1000) + ARROW_VERSION_MINOR) * 1000 + ARROW_VERSION_PATCH' >> $(@)",
)

cc_library(
    name = "arrow",
    srcs = [
        ":build_version",
        "cpp/src/arrow/array.cc",
        "cpp/src/arrow/builder.cc",
        "cpp/src/arrow/array/builder_adaptive.cc",
        "cpp/src/arrow/array/builder_base.cc",
        "cpp/src/arrow/array/builder_binary.cc",
        "cpp/src/arrow/array/builder_decimal.cc",
        "cpp/src/arrow/array/builder_dict.cc",
        "cpp/src/arrow/array/builder_nested.cc",
        "cpp/src/arrow/array/builder_primitive.cc",
        "cpp/src/arrow/array/builder_union.cc",
        "cpp/src/arrow/array/concatenate.cc",
        "cpp/src/arrow/array/dict_internal.cc",
        "cpp/src/arrow/array/diff.cc",
        "cpp/src/arrow/array/validate.cc",
        "cpp/src/arrow/buffer.cc",
        "cpp/src/arrow/compare.cc",
        "cpp/src/arrow/device.cc",
        "cpp/src/arrow/extension_type.cc",
        "cpp/src/arrow/memory_pool.cc",
        "cpp/src/arrow/pretty_print.cc",
        "cpp/src/arrow/record_batch.cc",
        "cpp/src/arrow/result.cc",
        "cpp/src/arrow/scalar.cc",
        "cpp/src/arrow/sparse_tensor.cc",
        "cpp/src/arrow/status.cc",
        "cpp/src/arrow/table.cc",
        "cpp/src/arrow/table_builder.cc",
        "cpp/src/arrow/tensor.cc",
        "cpp/src/arrow/tensor/coo_converter.cc",
        "cpp/src/arrow/tensor/csc_converter.cc",
        "cpp/src/arrow/tensor/csf_converter.cc",
        "cpp/src/arrow/tensor/csr_converter.cc",
        "cpp/src/arrow/type.cc",
        "cpp/src/arrow/visitor.cc",
        "cpp/src/arrow/c/bridge.cc",
        "cpp/src/arrow/io/buffered.cc",
        "cpp/src/arrow/io/caching.cc",
        "cpp/src/arrow/io/compressed.cc",
        "cpp/src/arrow/io/file.cc",
        "cpp/src/arrow/io/interfaces.cc",
        "cpp/src/arrow/io/memory.cc",
        "cpp/src/arrow/io/slow.cc",
        "cpp/src/arrow/testing/util.cc",
        "cpp/src/arrow/util/basic_decimal.cc",
        "cpp/src/arrow/util/bit_util.cc",
        "cpp/src/arrow/util/compression.cc",
        "cpp/src/arrow/util/cpu_info.cc",
        "cpp/src/arrow/util/decimal.cc",
        "cpp/src/arrow/util/delimiting.cc",
        "cpp/src/arrow/util/formatting.cc",
        "cpp/src/arrow/util/future.cc",
        "cpp/src/arrow/util/int_util.cc",
        "cpp/src/arrow/util/io_util.cc",
        "cpp/src/arrow/util/iterator.cc",
        "cpp/src/arrow/util/logging.cc",
        "cpp/src/arrow/util/key_value_metadata.cc",
        "cpp/src/arrow/util/memory.cc",
        "cpp/src/arrow/util/parsing.cc",
        "cpp/src/arrow/util/string.cc",
        "cpp/src/arrow/util/string_builder.cc",
        "cpp/src/arrow/util/task_group.cc",
        "cpp/src/arrow/util/thread_pool.cc",
        "cpp/src/arrow/util/time.cc",
        "cpp/src/arrow/util/trie.cc",
        "cpp/src/arrow/util/uri.cc",
        "cpp/src/arrow/util/utf8.cc",
        "cpp/src/arrow/vendored/base64.cpp",
        "cpp/src/arrow/vendored/datetime/tz.cpp",
        "cpp/src/arrow/vendored/double-conversion/bignum.cc",
        "cpp/src/arrow/vendored/double-conversion/double-conversion.cc",
        "cpp/src/arrow/vendored/double-conversion/bignum-dtoa.cc",
        "cpp/src/arrow/vendored/double-conversion/fast-dtoa.cc",
        "cpp/src/arrow/vendored/double-conversion/cached-powers.cc",
        "cpp/src/arrow/vendored/double-conversion/fixed-dtoa.cc",
        "cpp/src/arrow/vendored/double-conversion/diy-fp.cc",
        "cpp/src/arrow/vendored/double-conversion/strtod.cc",
        "cpp/src/arrow/ipc/dictionary.cc",
        "cpp/src/arrow/ipc/feather.cc",
        "cpp/src/arrow/ipc/message.cc",
        "cpp/src/arrow/ipc/metadata_internal.cc",
        "cpp/src/arrow/ipc/options.cc",
        "cpp/src/arrow/ipc/reader.cc",
        "cpp/src/arrow/ipc/writer.cc",
    ],
    hdrs = glob([
        "cpp/src/arrow/**/*.h",
        "cpp/src/arrow/**/*.hpp",
        "cpp/src/arrow/**/xxhash.c",
        "cpp/thirdparty/flatbuffers/include/flatbuffers/*.h",
        "cpp/src/generated/*",
    ]),
    includes = [
        "cpp/src",
        "cpp/thirdparty/flatbuffers/include",
    ],
    defines = [
    ],
    copts = [
        "-fno-omit-frame-pointer",
        "-momit-leaf-frame-pointer",
        "-msse",
        "-msse4.2",
        "-pthread",
        "-Wsign-compare",
        "-Wno-unused-parameter",
        "-Wno-unused-variable",
        "-Woverloaded-virtual",
        "-Wnon-virtual-dtor",
        "-Wno-missing-field-initializers",
        "-fno-builtin-memcmp",
        "-std=c++11",
        "-mpclmul",
        "-O2",
    ],
    linkopts = [
        "-lm",
        "-lpthread",
    ],
    deps = [
    ],
    visibility = ["//visibility:public"],
)

